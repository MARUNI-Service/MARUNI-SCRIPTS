# 개선된 평가 기준

**작성일**: 2025-11-11
**목적**: AI 응답 평가 시스템 개선 내용 기록

---

## 🎯 개선 목표

1차 테스트에서 발견된 평가 시스템의 문제점을 해결하기 위한 개선 작업

### 주요 문제점
- 키워드 커버리지 40% (실제 표현의 60% 누락)
- 질문 감지 실패율 50%
- 시나리오 2에서 실제 품질과 점수 괴리 (30% 이상)
- 부분 점수 미지원 (0점 또는 1점만 가능)

### 개선 목표
- 키워드 커버리지 → 80% 이상
- 질문 감지율 → 95% 이상
- 실제 품질 반영도 → 80% 이상
- 부분 점수 시스템 도입 (0, 0.5, 0.7, 1.0)

---

## ✅ 개선 내용

### 1. 키워드 목록 확장 (2-3배)

#### 공감 표현

**이전 (4개)**:
```python
"공감": ["네요", "그렇", "이해", "그러"]
```

**개선 후 (11개, 3단계)**:
```python
"공감": {
    "strong": ["외로우실", "힘드시", "불편하시", "걱정", "아프시", "슬프시"],  # 1.0점
    "medium": ["네요", "그렇", "이해", "그러시", "마음"],  # 0.7점
    "weak": []
}
```

**효과**:
- "외로우실 것 같아요" → 1.0점 (이전: 0점)
- "걱정되네요" → 1.0점 (이전: 0점)
- "그렇네요" → 0.7점 (이전: 1점)

#### 위로 표현

**이전 (4개)**:
```python
"위로": ["괜찮", "힘내", "대해", "괜찮"]  # "대해"는 오타
```

**개선 후 (10개, 3단계)**:
```python
"위로": {
    "strong": ["함께 있을게", "곁에서", "제가 있", "걱정 마세", "위로"],  # 1.0점
    "medium": ["괜찮", "힘내", "잘 될", "나아질"],  # 0.7점
    "weak": []
}
```

**효과**:
- "제가 곁에서 함께 있을게요" → 1.0점 (이전: 0점)
- "이야기 나누면서" → 부분 점수 가능
- "괜찮아요" → 0.7점 (기계적 위로는 감점)

#### 긍정적 방향

**이전 (3개)**:
```python
"긍정적 방향": ["좋", "괜찮", "함께"]
```

**개선 후 (8개, 3단계)**:
```python
"긍정적 방향": {
    "strong": ["함께", "같이", "이야기 나누", "대화"],  # 1.0점
    "medium": ["좋", "괜찮", "나아", "기분 전환"],  # 0.7점
    "weak": []
}
```

**효과**:
- "함께 이야기 나누면서" → 1.0점
- "좋아질 거예요" → 0.7점

#### 친근함

**이전 (3개)**:
```python
"친근함": ["!", "정말", "참"]
```

**개선 후 (8개, 3단계)**:
```python
"친근함": {
    "strong": ["!", "정말", "참", "딱", "아주"],  # 1.0점
    "medium": ["네요", "좋네요", "그렇네요"],  # 0.7점
    "weak": []
}
```

#### 관심

**이전 (3개)**:
```python
"관심": ["어떠", "괜찮", "어때"]
```

**개선 후 (9개, 3단계)**:
```python
"관심": {
    "strong": ["어떠", "어때", "어떻게", "괜찮", "많이", "혹시"],  # 1.0점
    "medium": ["요즘", "최근", "오늘"],  # 0.5점
    "weak": []
}
```

#### 이전 대화 언급

**이전 (4개)**:
```python
"이전 대화 언급": ["공원", "또", "역시", "전에"]
```

**개선 후 (9개, 3단계)**:
```python
"이전 대화 언급": {
    "strong": ["공원", "산책", "친구", "손자", "시험"],  # 1.0점 (명시적)
    "medium": ["또", "역시", "전에", "지난번"],  # 0.7점
    "weak": ["오늘도", "다시"]  # 0.5점
}
```

**효과**:
- "공원에 다녀오셨죠?" → 1.0점 (구체적 기억)
- "오늘도" → 0.5점 (일반적 연결어)

#### 함께 기뻐하기

**이전 (5개)**:
```python
"함께 기뻐하기": ["축하", "잘됐", "다행", "좋", "기쁘"]
```

**개선 후 (9개, 3단계)**:
```python
"함께 기뻐하기": {
    "strong": ["축하", "기쁘", "잘됐", "다행", "자랑스", "대단"],  # 1.0점
    "medium": ["좋", "멋지", "훌륭"],  # 0.7점
    "weak": []
}
```

---

### 2. 질문 감지 로직 개선 (정규표현식)

#### 이전 방식 (단순 키워드)

```python
"질문": ["?", "어때", "어떠", "시나요", "세요?"]
```

**문제**:
- "있으셨나요?" → 미감지
- "계신가요?" → 미감지
- "하실 건가요?" → 미감지

**미감지율**: ~50%

#### 개선 후 (정규표현식 패턴)

```python
question_patterns = [
    r'\?',                      # 물음표
    r'[가-힣]+[을를]까요\?*',   # ~을까요, ~를까요
    r'[가-힣]+[니나]까\?*',     # ~니까, ~나까
    r'[가-힣]+세요\?*',         # ~세요?
    r'[가-힣]+신가요\?*',       # ~신가요?
    r'[가-힣]+시나요\?*',       # ~시나요?
    r'[가-힣]+셨나요\?*',       # ~셨나요?
    r'[가-힣]+있나요\?*',       # ~있나요?
    r'[가-힣]+있으신가요\?*',   # ~있으신가요?
    r'[가-힣]+있으셨나요\?*',   # ~있으셨나요?
    r'어때.*\?*',               # 어때~
    r'어떠.*\?*',               # 어떠~
    r'어떻.*\?*',               # 어떻~
    r'어떤.*\?*',               # 어떤~
    r'혹시.*\?*',               # 혹시~
]
```

**효과**:
- "특별히 하신 일이 있으셨나요?" → ✅ 감지 (이전: ❌)
- "어떤 일들이 있으셨나요?" → ✅ 감지 (이전: ❌)
- "어떤 경치를 기대하고 계신가요?" → ✅ 감지 (이전: ❌)
- "산책 다녀오실 건가요?" → ✅ 감지 (이전: ❌)

**예상 감지율**: ~95%

---

### 3. 부분 점수 시스템 도입

#### 이전 방식 (이진 평가)

```python
for element in expected_elements:
    if any(keyword in response for keyword in keywords_map[element]):
        score += 1  # 0점 또는 1점만 가능
```

**문제**:
- "그렇군요" (기계적) = 1점
- "외로우실 것 같아요" (진심) = 1점
- 둘 다 동일한 점수

#### 개선 후 (3단계 평가)

```python
if any(keyword in response for keyword in keyword_set.get("strong", [])):
    element_score = 1.0  # 만점
elif any(keyword in response for keyword in keyword_set.get("medium", [])):
    element_score = 0.7  # 중간
elif any(keyword in response for keyword in keyword_set.get("weak", [])):
    element_score = 0.5  # 약함
else:
    element_score = 0.0  # 없음
```

**점수 범위**: 0.0, 0.5, 0.7, 1.0

**효과**:
- "외로우실 것 같아요" → 1.0점 (strong 공감)
- "그렇네요" → 0.7점 (medium 공감)
- "네" → 0점 (공감 없음)

---

### 4. 의료 조언 금지 키워드 확대

**이전 (6개)**:
```python
medical_keywords = ["병원", "의사", "약", "치료", "진료", "처방"]
```

**개선 후 (8개)**:
```python
medical_keywords = ["병원", "의사", "약", "치료", "진료", "처방", "증상", "질환"]
```

---

## 📊 예상 개선 효과

### 1차 테스트 결과 재평가 (시뮬레이션)

#### 시나리오 2: 부정적 감정 대화

| 설정 | 응답 | 이전 점수 | 개선 후 예상 | 개선 효과 |
|------|------|-----------|-------------|----------|
| improved1 | "혼자 계셔서 외로우셨군요. 지난번에 말씀하신..." | 0/3 (0%) | ~1.4/3 (47%) | ⚠️ 할루시네이션 감점 |
| improved1-v2 | "**혼자 계시는 시간이 길어서 외로우실 것 같아요**. 저와 **함께 이야기 나누면서**..." | 1/3 (33%) | **2.7/3 (90%)** | ✅ +167% |
| improved1-v3 | "혼자 계시는 시간이 길어서 많이 **외로우실** 것 같아요. **제가 곁에서 함께 있을게요**." | 1/3 (33%) | **3.0/3 (100%)** | ✅ +200% |

**예상 점수 변화**:
- improved1-v2: 1.0 → 2.7 (+1.7점, +170%)
- improved1-v3: 1.0 → 3.0 (+2.0점, +200%)

**분석**:
- "외로우실 것 같아요" → 공감 1.0점 (이전: 0점)
- "함께 있을게요" → 위로 1.0점 (이전: 0점)
- "이야기 나누면서" → 긍정적 방향 1.0점 (이전: 0점)

#### 시나리오 1: 긍정적 일상 대화

| 설정 | 응답 | 이전 점수 | 개선 후 예상 |
|------|------|-----------|-------------|
| improved1 | "요즘 산책 다니시는 길에 특별히 눈에 들어오는 게 있으신가요?" | 3/3 (100%) | 3.0/3 (100%) |
| improved1-v2 | "오늘 날씨 덕분에 **특별히 하신 일이 있으셨나요?**" | 2/3 (67%) | **3.0/3 (100%)** |
| improved1-v3 | "오늘은 특별히 외출 계획이 있으신가요?" | 3/3 (100%) | 3.0/3 (100%) |

**예상 점수 변화**:
- improved1-v2: 2.0 → 3.0 (+1.0점, +50%)

**분석**:
- "있으셨나요?" → 질문 1.0점 (이전: 0점, 정규표현식으로 감지)

#### 시나리오 5: 가족 관련 대화

| 설정 | 응답 | 이전 점수 | 개선 후 예상 |
|------|------|-----------|-------------|
| improved1 | "손자에게 칭찬과 격려 많이 해주셨나요?" | 2/3 (67%) | 3.0/3 (100%) |
| improved1-v2 | "**오늘은 또 어떤 일들이 있으셨나요?**" | 1/3 (33%) | **2.7/3 (90%)** |
| improved1-v3 | "손자와 함께 어떤 축하 계획을 하실 건가요?" | 2/3 (67%) | 3.0/3 (100%) |

**예상 점수 변화**:
- improved1-v2: 1.0 → 2.7 (+1.7점, +170%)

---

### 전체 점수 변화 예측

| 설정 | 1차 테스트 (이전 기준) | 2차 테스트 예상 (개선 기준) | 변화 |
|------|----------------------|--------------------------|------|
| improved1 | 10/15 (66.7%) | ~12.5/15 (83.3%) | +16.6% |
| improved1-v2 | 9/15 (60.0%) | **~14.0/15 (93.3%)** | +33.3% |
| improved1-v3 | 11/15 (73.3%) | **~14.5/15 (96.7%)** | +23.4% |

**예상 순위 변화**:
1. improved1-v3: **96.7%** (1위 유지, 점수 상승)
2. improved1-v2: **93.3%** (3위 → 2위, 급상승)
3. improved1: 83.3% (2위 → 3위)

**핵심 발견**:
- v2의 진짜 실력이 제대로 측정될 것으로 예상
- v2와 v3의 차이가 축소될 것 (파라미터보다 프롬프트가 더 중요)

---

## 📊 개선 효과 요약

### 키워드 커버리지

| 평가 요소 | 이전 키워드 수 | 개선 후 | 증가율 |
|----------|--------------|---------|--------|
| 공감 | 4개 | 11개 | +175% |
| 위로 | 4개 | 10개 | +150% |
| 긍정적 방향 | 3개 | 8개 | +167% |
| 질문 | 5개 패턴 | 15개 정규식 | +200% |
| 평균 | - | - | **+173%** |

### 평가 정확도

| 측정 지표 | 이전 | 개선 후 예상 | 개선 |
|----------|------|-------------|------|
| 질문 감지율 | ~50% | ~95% | +90% |
| 공감 표현 인식 | ~40% | ~85% | +113% |
| 위로 표현 인식 | ~25% | ~80% | +220% |
| 실제 품질 반영도 (시나리오 2) | ~30% | ~90% | +200% |

---

## 🎯 남은 한계점

### 1. 여전히 키워드 기반
- GPT 기반 평가가 아님
- 맥락 이해 불가능
- 어순 영향 받을 수 있음

### 2. 단순 패턴 매칭
- "외로우실 것 같아요"와 "외로우실 리 없어요"를 구분 못함
- 부정문 처리 미흡

### 3. 시나리오별 차별화 부족
- 모든 시나리오에 동일한 평가 방식
- 가중치 시스템 미적용

### 향후 개선 방향
1. GPT-4를 활용한 품질 평가 (비용 고려 필요)
2. 감정 분석 결과 활용
3. 시나리오별 가중치 시스템 도입
4. 응답 길이, 문장 수 등 정량적 지표 추가

---

## 🔧 구현 정보

### 파일 위치
- `scripts/ai_response_comparison_test.py`
- 함수: `evaluate_response()` (Line 423-560)

### 핵심 변경사항
1. `score` 변수 타입: `int` → `float` (부분 점수 지원)
2. 키워드 맵 구조: `List[str]` → `Dict[str, List[str]]` (strong/medium/weak)
3. 질문 감지: 단순 문자열 → 정규표현식 패턴
4. 평가 로직: 이진 평가 → 3단계 부분 점수

### 의존성
- Python 기본 `re` 모듈 사용 (추가 설치 불필요)

---

## 📝 다음 단계

1. ✅ 평가 기준 개선 완료
2. ⏳ 2차 테스트 실행 (improved1, v2, v3)
3. ⏳ 1차 vs 2차 결과 비교
4. ⏳ 최종 권장사항 도출

---

**작성일**: 2025-11-11
**다음 문서**: 2차 테스트 결과 및 최종 비교 분석
