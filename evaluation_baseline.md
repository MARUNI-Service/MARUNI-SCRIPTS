# 평가 기준 개선 기록

**작성일**: 2025-11-11
**목적**: AI 응답 평가 시스템 개선 전 기준선 기록

---

## 📋 기존 평가 기준 (Baseline)

### 평가 방식: 키워드 기반 휴리스틱 매칭

각 시나리오마다 3개의 평가 요소가 있고, 각 요소마다 키워드 목록으로 매칭하여 점수를 부여합니다.

### 시나리오별 평가 요소

| 시나리오 | 평가 요소 1 | 평가 요소 2 | 평가 요소 3 |
|----------|-------------|-------------|-------------|
| 1. 긍정적 일상 대화 | 공감 | 질문 | 친근함 |
| 2. 부정적 감정 대화 | 공감 | 위로 | 긍정적 방향 |
| 3. 건강 관련 대화 | 공감 | 의료조언 회피 | 관심 |
| 4. 멀티턴 대화 | 이전 대화 언급 | 자연스러운 연결 | 구체적 질문 |
| 5. 가족 관련 대화 | 이전 대화 기억 | 함께 기뻐하기 | 추가 질문 |

### 키워드 매핑 규칙

```python
keywords_map = {
    "공감": ["네요", "그렇", "이해", "그러"],
    "질문": ["?", "어때", "어떠", "시나요", "세요?"],
    "친근함": ["!", "정말", "참"],
    "위로": ["괜찮", "힘내", "대해", "괜찮"],
    "긍정적 방향": ["좋", "괜찮", "함께"],
    "의료조언 회피": [],  # 의료 용어가 없으면 통과
    "관심": ["어떠", "괜찮", "어때"],
    "이전 대화 언급": ["공원", "또", "역시", "전에"],
    "자연스러운 연결": ["오늘도", "또", "다시"],
    "구체적 질문": ["?", "어떠", "어때"],
    "이전 대화 기억": ["손자", "시험", "공원", "친구"],
    "함께 기뻐하기": ["축하", "잘됐", "다행", "좋", "기쁘"]
}

# 의료 조언 금지 키워드
medical_keywords = ["병원", "의사", "약", "치료", "진료", "처방"]
```

### 평가 로직

```python
def evaluate_response(response: str, expected_elements: List[str]) -> tuple:
    score = 0
    max_score = len(expected_elements)  # 3점 만점

    for element in expected_elements:
        if element == "의료조언 회피":
            # 의료 관련 키워드가 없으면 1점 부여
            if not any(keyword in response for keyword in medical_keywords):
                score += 1
        elif element in keywords_map:
            # 키워드 중 하나라도 매칭되면 1점 부여
            if any(keyword in response for keyword in keywords_map[element]):
                score += 1

    return score, max_score
```

### 별점 계산

| 충족률 | 별점 |
|--------|------|
| 90% 이상 (3/3) | ⭐⭐⭐⭐⭐ |
| 70% 이상 (2.1/3 이상) | ⭐⭐⭐⭐ |
| 50% 이상 (1.5/3 이상) | ⭐⭐⭐ |
| 30% 이상 (0.9/3 이상) | ⭐⭐ |
| 30% 미만 | ⭐ |

---

## 🧪 1차 테스트 결과 (2025-11-10 23:57)

### 테스트 설정

- **improved1**: Temperature 0.7, max-tokens 100, 기본 프롬프트
- **improved1-v2**: Temperature 0.7, max-tokens 100, 부정적 감정 + 건강 대화 프롬프트 강화
- **improved1-v3**: Temperature 0.8, max-tokens 120, v2 프롬프트 적용

### 종합 결과

| 설정 | 총점 | 순위 |
|------|------|------|
| **improved1-v3** | 11/15 (73.3%) | 🥇 1위 |
| improved1 | 10/15 (66.7%) | 🥈 2위 |
| improved1-v2 | 9/15 (60.0%) | 🥉 3위 |

### 시나리오별 상세 결과

#### 시나리오 1: 긍정적 일상 대화

| 설정 | AI 응답 | 점수 |
|------|---------|------|
| improved1 | "안녕하세요! 오늘 날씨가 참 좋다고 하시니 기분이 좋아지네요. 이렇게 좋은 날엔 산책도 괜찮겠죠? 요즘 산책 다니시는 길에 특별히 눈에 들어오는 게 있으신가요?" | 3/3 ⭐⭐⭐⭐⭐ |
| improved1-v2 | "오늘 날씨가 참 좋다니 기분이 좋으셨겠어요. 따뜻한 햇살이 마음까지 환하게 해주었길 바라요. 오늘 날씨 덕분에 특별히 하신 일이 있으셨나요?" | 2/3 ⭐⭐⭐ |
| improved1-v3 | "오늘 날씨가 정말 좋네요! 햇살이 따뜻해서 기분도 한결 밝아지는 것 같아요. 오늘은 특별히 외출 계획이 있으신가요?" | 3/3 ⭐⭐⭐⭐⭐ |

**분석**:
- v2가 질문을 했는데도 "질문" 항목 0점 처리
- 질문: "오늘 날씨 덕분에 특별히 하신 일이 있으셨나요?" (명확한 질문)
- 문제: "있으셨나요?"는 키워드 목록에 없음

#### 시나리오 2: 부정적 감정 대화 ⚠️ 가장 중요

| 설정 | AI 응답 | 점수 | 실제 품질 |
|------|---------|------|----------|
| improved1 | "혼자 계셔서 외로우셨군요. **지난번에 말씀하신 산책을** 요즘도 하시나요? 가끔 바깥 공기 쐬면 기분이 조금 나아질 수도 있을 것 같아요. 오늘 날씨는 어떤가요?" | 0/3 ⭐ | ❌ 할루시네이션 |
| improved1-v2 | "**혼자 계시는 시간이 길어서 외로우실 것 같아요**. 저와 함께 이야기 나누면서 조금이라도 기분이 나아지셨으면 좋겠어요. **오늘 어떤 일들이 있으셨는지 이야기해 주실래요?**" | 1/3 ⭐⭐ | ✅ 구체적 공감 |
| improved1-v3 | "**혼자 계시는 시간이 길어서 많이 외로우실 것 같아요**. **제가 곁에서 함께 있을게요**. 오늘 하루 어떻게 보내셨는지 이야기 나눠주실래요?" | 1/3 ⭐⭐ | ✅ 최고 품질 |

**핵심 발견**:
- ✅ **v2와 v3가 목표 달성**: "혼자 계시는 시간이 길어서 외로우실 것 같아요" (구체적 공감)
- ✅ **v3의 탁월한 위로**: "제가 곁에서 함께 있을게요" (따뜻한 위로)
- ❌ **평가 시스템 실패**: 실제 품질이 크게 개선되었는데 1점만 인정
- ❌ improved1의 할루시네이션 ("지난번에 말씀하신") 해결됨

**왜 1/3점만?**
- "공감" 키워드: ["네요", "그렇", "이해", "그러"] → "외로우실 것 같아요"는 미포함
- "위로" 키워드: ["괜찮", "힘내", "대해", "괜찮"] → "함께 있을게요"는 미포함
- "긍정적 방향" 키워드: ["좋", "괜찮", "함께"] → "함께"만 매칭 (1점)

#### 시나리오 3: 건강 관련 대화

| 설정 | AI 응답 | 점수 |
|------|---------|------|
| improved1 | "무릎이 아프시다니 마음이 안 좋네요. 요즘 날씨가 좀 쌀쌀해져서 그런 걸까요? 따뜻하게 하고 계신가요? 혹시 최근에 무릎에 무리가 가는 일이 있었나요? 무리하지 않으시도록 조..." | 2/3 ⭐⭐⭐ |
| improved1-v2 | "무릎이 아프시다니 **걱정되네요**. 오늘은 많이 불편하셨나요? **무리하지 마시고 푹 쉬셨으면** 좋겠어요. 따뜻하게 해주시고 편안히 쉬시길 바라요." | 2/3 ⭐⭐⭐ |
| improved1-v3 | "무릎이 아프시다고 하니 **걱정이 되네요**. 많이 불편하시진 않으신가요? 오늘은 **무리하지 마시고 푹 쉬시면** 좋겠어요. 따뜻하게 해주시고 편안히 쉬시길 바랍니다. 최근에 즐거운 일이나 좋은 일이 있으셨나요?" | 2/3 ⭐⭐⭐ |

**분석**:
- 모두 2/3점으로 동일 점수
- v2와 v3의 프롬프트 강화 효과("걱정되네요", "무리하지 마시고")가 점수에 반영 안됨
- 실제로는 v2, v3가 improved1보다 더 따뜻하고 배려 있는 응답

#### 시나리오 4: 멀티턴 대화

| 설정 | AI 응답 | 점수 |
|------|---------|------|
| improved1 | "오늘도 공원에 다녀오실 계획이시군요! 요즘 날씨가 참 좋으니 산책하시기 딱 좋은 것 같아요. 공원에서 어떤 활동을 하실 예정이신가요? 산책하시면서 좋은 시간을 보내셨으면 좋겠어요." | 3/3 ⭐⭐⭐⭐⭐ |
| improved1-v2 | "오늘도 공원에 다녀오실 계획이시군요! 가을의 상쾌한 바람을 느끼기에 딱 좋은 날씨죠. 오늘은 어떤 경치를 기대하고 계신가요?" | 3/3 ⭐⭐⭐⭐⭐ |
| improved1-v3 | "오늘도 공원에 다녀오실 계획이시군요! 날씨도 좋고 산책하기에 딱 좋은 날씨일 것 같아요. 오늘은 특별히 같이 가실 친구분이 계신가요, 아니면 혼자 조용히 다녀오실 생각이신가요?" | 3/3 ⭐⭐⭐⭐⭐ |

**분석**:
- 모든 설정이 만점 - 차별성 측정 불가
- "오늘도", "공원" 키워드로 쉽게 점수 획득

#### 시나리오 5: 가족 관련 대화

| 설정 | AI 응답 | 점수 |
|------|---------|------|
| improved1 | "손자가 시험 결과가 좋게 나왔다니 정말 기쁘시겠어요! 그동안 열심히 공부한 보람이 있네요. 손자에게 칭찬과 격려 많이 해주셨나요? 혹시 이번 주말에 손자와 축하할 계획 있으신가요?" | 2/3 ⭐⭐⭐ |
| improved1-v2 | "정말 기쁜 소식이네요! 손자분이 열심히 준비한 보람이 있었나 봐요. 손자분과 함께 기쁨을 나누셨겠어요. **오늘은 또 어떤 일들이 있으셨나요?**" | 1/3 ⭐⭐ |
| improved1-v3 | "정말 기쁘시겠어요! 손자가 열심히 노력한 결과라 더욱 자랑스러우실 것 같아요. 손자와 함께 어떤 축하 계획을 하실 건가요?" | 2/3 ⭐⭐⭐ |

**문제 발견**:
- v2가 "추가 질문"을 했는데 0점 처리
- 질문: "오늘은 또 어떤 일들이 있으셨나요?" (명확한 추가 질문)
- 키워드 목록에 "있으셨나요?"가 없어서 미인정

---

## ❌ 기존 평가 기준의 문제점

### 1. 키워드 목록이 너무 제한적

#### 문제 사례 1: 공감 표현 누락
```
현재 키워드: ["네요", "그렇", "이해", "그러"]

누락된 진짜 공감 표현들:
- "외로우실 것 같아요" (구체적 공감)
- "걱정되네요" (걱정 표현)
- "힘드시겠어요" (고충 이해)
- "불편하시겠어요" (상황 공감)
```

#### 문제 사례 2: 위로 표현 누락
```
현재 키워드: ["괜찮", "힘내", "대해", "괜찮"]

누락된 진짜 위로 표현들:
- "함께 있을게요" (동반 약속)
- "곁에서 있을게요" (지지 표현)
- "이야기 나누면서" (대화 초대)
- "제가 여기 있어요" (존재 확인)
```

### 2. 질문 감지 로직 실패

```python
"질문": ["?", "어때", "어떠", "시나요", "세요?"]
```

**미감지 사례**:
- "특별히 하신 일이 있으셨나요?" → "있으셨나요?" 미포함
- "어떤 일들이 있으셨나요?" → "있으셨나요?" 미포함
- "어떤 경치를 기대하고 계신가요?" → "계신가요?" 미포함

**원인**: 질문 종결어미 패턴이 불완전함

### 3. 실제 품질과 점수의 심각한 괴리

#### 시나리오 2 (부정적 감정 대화) 비교

| 설정 | 실제 품질 평가 | 점수 | 괴리도 |
|------|---------------|------|--------|
| improved1 | ❌ 할루시네이션으로 최악 | 0/3 | 정확 |
| improved1-v2 | ✅ 구체적 공감 + 대화 초대 | 1/3 | ⚠️ 과소평가 |
| improved1-v3 | ✅ 최고 품질 위로 | 1/3 | ⚠️ 심각한 과소평가 |

**v3 응답 품질**:
- "혼자 계시는 시간이 길어서 많이 외로우실 것 같아요" ← 완벽한 구체적 공감
- "제가 곁에서 함께 있을게요" ← 탁월한 감정적 위로
- "이야기 나눠주실래요?" ← 자연스러운 대화 초대

→ 실제로는 **3/3점 수준**인데 **1/3점**만 부여됨

### 4. 이진 평가의 한계

현재 시스템:
- 키워드 매칭되면: 1점
- 매칭 안되면: 0점
- **부분 점수 없음**

문제:
- 응답의 미묘한 품질 차이를 구분할 수 없음
- "그렇군요"(기계적 공감)와 "외로우실 것 같아요"(진심 공감)가 동일한 1점

### 5. 시나리오별 특성 미반영

모든 시나리오에 동일한 평가 방식 적용:
- 부정적 감정 대화는 "공감 깊이"가 중요 → 현재는 키워드만 체크
- 건강 대화는 "의료 조언 회피 + 따뜻한 배려"가 중요 → 배려 표현 미평가
- 가족 대화는 "함께 기뻐하는 감정 표현"이 중요 → "축하" 키워드만 체크

---

## 📊 통계적 문제

### 키워드 커버리지 분석

실제 응답에서 사용된 표현 vs 키워드 목록 매칭률:

| 평가 요소 | 키워드 수 | 실제 응답 표현 | 매칭률 |
|----------|----------|---------------|--------|
| 공감 | 4개 | 10+ 가지 | ~40% |
| 위로 | 4개 | 8+ 가지 | ~25% |
| 질문 | 5개 | 15+ 가지 | ~33% |

**결론**: 평균적으로 60-75%의 좋은 응답이 평가에서 누락됨

### 점수 분포의 왜곡

| 시나리오 | 평균 점수 | 실제 체감 품질 | 차이 |
|----------|----------|---------------|------|
| 시나리오 1 | 2.7/3 (90%) | 우수 | 정확 |
| 시나리오 2 | 0.7/3 (23%) | 중상 | **심각한 과소평가** |
| 시나리오 3 | 2.0/3 (67%) | 중상 | 약간 과소평가 |
| 시나리오 4 | 3.0/3 (100%) | 우수 | 정확 |
| 시나리오 5 | 1.7/3 (56%) | 중상 | 과소평가 |

**가장 중요한 시나리오 2**가 가장 부정확하게 평가됨

---

## 🎯 개선 필요성 요약

### 긴급도 높음 (Must Fix)

1. **시나리오 2 (부정적 감정) 평가 개선**
   - 현재: 실제 품질과 30% 이상 괴리
   - 영향: 프로젝트의 핵심 기능인 감정 케어 품질 측정 불가

2. **질문 감지 로직 수정**
   - 현재: 명확한 질문도 50% 이상 미감지
   - 영향: 대화 연결성 평가 왜곡

### 중요도 높음 (Should Fix)

3. **키워드 목록 대폭 확대**
   - 현재: 실제 표현의 40%만 커버
   - 영향: 전반적인 평가 정확도 저하

4. **부분 점수 시스템 도입**
   - 현재: 0점 또는 1점만 가능
   - 영향: 미묘한 품질 차이 구분 불가

### 개선 권장 (Nice to Have)

5. **시나리오별 맞춤형 평가**
   - 현재: 모든 시나리오에 동일 방식 적용
   - 영향: 각 시나리오의 특성 반영 부족

6. **응답 품질 점수 추가**
   - 현재: 키워드 매칭만 평가
   - 영향: 전반적인 응답 품질 측정 부족

---

## 📝 개선 계획

### Phase 1: 즉시 개선 (30분)
- 키워드 목록 2-3배 확대
- 질문 감지 로직 수정
- 시나리오 2, 3 평가 기준 강화

### Phase 2: 시스템 개선 (1시간)
- 시나리오별 맞춤형 평가 도입
- 가중치 시스템 적용
- 부분 점수 시스템 구현

### Phase 3: 검증 (20분)
- 개선된 평가 기준으로 2차 테스트
- 1차 vs 2차 결과 비교
- 최종 권장사항 도출

---

## 📌 참고 자료

### 원본 평가 코드 위치
- 파일: `scripts/ai_response_comparison_test.py`
- 함수: `evaluate_response()` (Line 423-476)
- 키워드 맵: Line 438-451

### 1차 테스트 결과 파일
- JSON: `scripts/output/responses_20251111_000106.json`
- 보고서: `scripts/output/comparison_report_20251111_000106.md`

### 관련 설정 파일
- `src/main/resources/application-ai-improved1.yml`
- `src/main/resources/application-ai-improved1-v2.yml`
- `src/main/resources/application-ai-improved1-v3.yml`

---

**다음 단계**: 평가 기준 개선 작업 진행 → `evaluation_improved.md` 작성
